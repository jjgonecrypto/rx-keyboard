<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rx Keyboard</title>
  <script src="./node_modules/rx/dist/rx.lite.js"></script>
  <script src="./node_modules/soundfont-player/dist/soundfont-loader.js"></script>
  <script src="./build/teoria.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
        var ctx = new AudioContext();

        var teoria = require('teoria');
        // window.Rx
        // window.soundfont

        function createLoopScale(fromNote, name) {
            var notesUp = teoria.note(fromNote).scale(name).notes();
            return notesUp.concat([teoria.note(fromNote).interval('P8')]).concat(notesUp.reverse());
        }

        // load instrument
        soundfont(ctx, 'acoustic_grand_piano').then(function(instrument) {
            var notes = createLoopScale('c3', 'minor');
            var upThird = createLoopScale('eb4', 'major');

            // step 1 : simple spread over 300ms intervals
            // var stream = Rx.Observable.interval(300).map(function (i) { return notes[i]; }).take(notes.length);


            var streamA = Rx.Observable.interval(300).map(function (i) { return notes[i]; });
            var streamB = Rx.Observable.interval(300).map(function (i) { return upThird[i]; }).delay(100);

            streamA.merge(streamB).take(notes.length * 2).subscribe(function onNext(note) {
                console.log(note.toString());
                instrument.play(note.toString(), ctx.currentTime, 250);
            }, function onError() {
                console.log('error');
            }, function onComplete() {
                console.log('complete');
            });

        });
    });
  </script>
  <style>

  </style>
</head>
<body>

</body>
</html>
